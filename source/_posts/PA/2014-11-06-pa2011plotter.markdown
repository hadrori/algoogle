---
layout: post
title: "PA 2011 Plotter"
date: 2014-11-06 02:25:21 +0900
comments: true
category: PA
tags: [math]
---

[Plotter](http://main.edu.pl/en/archive/pa/2011/plo)

#### 問題概要

****

{% math %}

L_{1} = L\\
\rightarrow \_L\_ \rightarrow LLR = L_{2}\\
\rightarrow \_L\_L\_R\_ \rightarrow LLRLLRR = L_{3}\\

{% endmath %}

というように, 次の列は前の列の文字の間にLとRを交互に挿入したもののn個目の列を考える.  
  
原点から初めて(1,1)に線分を伸ばしたものを考える.  
そこからさっきの列を左からみていき, Lなら左に{% m %}sqrt{2}{% em %}進め, Rなら右に{% m %}sqrt{2}{% em %}進める.  
このときm個の座標について, その点を通る回数と通る時刻を列挙せよ

#### 解法

****

列は以下の様な定義に書き換えることができる.

{% math %}

L_{1} = L\\
L_{i} = L_{i-1}Lr(L_{i})\\

{% endmath %}

r()は文字列の順序を反転させ, さらにLとRを入れ替えたもの.  
また, {% m %}L_{i}{% em %}が終わった時点での位置は

{% math %}

x_{i} = x_{i-1}-y_{i-1}\\
y_{i} = x_{i-1}+y_{i-1}\\

{% endmath %}

nは2000ぐらいだが, クエリで来る座標が{% m %}10^{9}{% em %}程度なので終端点が大幅にはみ出たら適当に打ち切ればいい.  
  
列の新しい定義から, 折れ線の最初と最後の2つに分けて再帰的にみれば線分上にある場合の端点からの距離がわかる.  

{% math %}

d(x,y,n) = d(x,y,n-1) \cup \{2^{n}-k: k\in d(y_{n}-y,x-x_{n},n-1)\}

{% endmath %}

しかしこれでは{% m %}O(2^{n}){% em %}で死ぬので枝刈りを入れる.  
得られる折れ線を囲む四角形を考える. その外なら打ち切る.  
原点からの4辺までの距離(原点は四角形の内部であることに注意する)をr, t, l, bとする.

{% math %}

r_{1} = t_{1} = 1\\
l_{1} = b_{1} = 0\\

r_{i} = max(r_{i-1}, t_{i-1}+x_{i})\\
t_{i} = max(t_{i-1}, l_{i-1}+y_{i})\\
l_{i} = max(l_{i-1}, b_{i-1}-x_{i})\\
b_{i} = max(b_{i-1}, r_{i-1}-y_{i})\\

{% endmath %}

この枝刈りは根本的で, {% m %}O(n){% em %}まで削ることができる.

#### コード

****

{% include_code PA/2011/Plotter.cpp %}
