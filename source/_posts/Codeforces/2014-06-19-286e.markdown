---
layout: post
title: "Codeforces 286E Ladies' Shop"
date: 2014-06-19 00:00:29 +0900
comments: true
category: Codeforces
tags: [fft, math]
---

[Ladies' Shop](http://codeforces.com/problemset/problem/286/E)

#### 問題概要

****

それぞれ重さがa[i](<=m)のn個のバッグがある. 今そのバッグに入れる品物の種類を以下のように決めたい.  

* 全てのバッグに対して, ちょうど重さの和がそのバッグの重さと等しくなるように品物をとってこれる. ただし選ぶ品物は何種類でもよくて, さらにそれぞれの種類を複数持ってくることもできる.
* 重さの総和が1以上m以下になるように品物を任意種類, 任意個取ってくるとその重さの総和は必ずいずれかのバッグの重さと必ず一致する.
* これらを満たすときの品物の種類の数が最小になるもの

#### 解法

****

重さを次数とした多項式fを考える. fの各項の係数をその項の次数のバッグの重さが存在するかどうかとする.  
このfを2乗すると, 各係数はバッグの重さから重複を許してちょうど2個選んだときの各重さの順列になる.  
なんとなく例としてサンプル1でみてみる.

```
weight: 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
f     : 0  0  0  0  0  1  1  1  1  1  1  0  0  0  0  0  0  0  0  0  0
f^2   : 0  0  0  0  0  0  0  0  0  0  1  2  3  4  5  6  5  4  3  2  1
```

このf^2より, 品物を2個選んだときにできる重さがわかるのでfと比較して答えを出せる.  
  
以降はm以下の重さについて
  
fにあって, f^2にない品物について  
3個以上選んでもその重さは明らかに存在し得ない.  
よって条件から必ず必要.  
  
f^2にあってfにない品物について  
条件を満たさないので明らかにNO.  
3個以上とか関係ない.  
  
どちらにもある場合はその品物を選ぶ必要はない(それ以下の重さで作れるということなので)  
  
どちらにもない場合について  
バッグの重さの最大の2倍までは1個でも2個で作れないならどうやっても作ることが出来ないので無視  
2倍より大きい場合, 最低でも3個使っていて, 2個では作れない数になっている.  
2個では作れないので, それらを2つの塊に分けたら少なくともどちらかのの重さの和はバッグの重さの最大を超えているはず.  
そのような場合は条件から除外されなければならず, その除外は現在の重さより前に行われる.  
よってこの場合も無視してよい.
  
以上から答えの集合はfにあってf^2にないものが必要十分であるとわかり, そのような集合の要素は上でNOでないなら必ず1つ以上存在する.  
重さが最大で10^6あり愚直に積を求めるとO(N^2)でTLEするので, FFTでO(NlogN)に落として計算することにする.  

#### コード

****

{% include_code Codeforces/286E.cpp %}
